<div class='fieldset optinradio_fieldset'><label class='optin_lang'>Would you like to receive updates about our news, campaigns and appeals by email? <a href='http://www.reprieve.org.uk/privacy/' target='_blank'>(see our privacy policy)</a></label>
  <label for='optin_1'><input id='optin_1' class='optinradio' name='optin' value='Yes' type='radio' required>Yes</label>
  <label for='optin_0'><input id='optin_0' class='optinradio' name='optin' value='No' type='radio'>No</label>
  <p id='optin_warning'>Don't want to hear from us? If you're already on our mailing list, selecting this option may unsubscribe you from our alerts.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="slide2 slide darkslide" style="display: none;">

  <div class="container">
    <div class="row">
      <div class="col-md">
        <!-- TODO: Edit text above share buttons below. Place to edit Twitter and Facebook text itself is further down. -->
        <h2>Thank you <span class="first_name"></span> for signing the petition</h2>
        <h4>Can you help us by sharing the petition?</h4>
        <button class="solid button facebook_share" onclick="return submitAndShare();">Share on Facebook</button> <button class="solid button twitter_share">Share on Twitter</a>
          <button class="button outline" id="slide2_skip">Skip</button>
      </div>
    </div>
  </div>
</div>


<div class="slide3 slide darkslide" style="display: none;">



  <div class="container">
    <div class="row">
      <div class="col-md">
        <!-- TODO: Add text to convince people to donate below! You may not need three lines, so feel free to delete the <p></p> section if not. -->
        <div class="unsigned">
          <h2>Help make our work possible</h2>
          <p>We will need more than just a petition to make real change. This isn’t a campaign that we can win in a day or a week or a month. We’ll need to consistently raise these cases, build pressure on Egypt and its allies, and use our expertise
            to ensure that Egypt undertakes much needed reforms. We can do it – but we need your help. <strong>Can you donate and make a difference?</strong></p>


        </div>

        <!-- TODO: Change URLs below to URL of relevant donation page. PLEASE rememember to create a source code. -->

        <div class="donate-tab-container ukdonate">
          <div class="donate-tab-top clearfix">
            <div class="donate-tab-gn donate-tab picked-tab">
              <h2>Give Now</h2>
            </div>
            <div class="donate-tab-gm donate-tab">
              <h2>Give Monthly</h2>
            </div>

          </div>
          <div class="donate-tab-main clearfix">
            <div class="donate-tab-givenow donate-tab-body picked-body">
              <p>Give an individual donation now to fund our most urgent cases.</p>
              <a class="button solid small donateButton donateNButton" target="_blank" href="https://act.reprieve.org.uk/page/contribute/egypt-1018?source=eg1018gnpet&amp;default_amt=10">£10
              </a><a class="button solid small donateButton donateNButton" target="_blank" href="https://act.reprieve.org.uk/page/contribute/egypt-1018?source=eg1018gnpet&amp;default_amt=25">£25
              </a><a class="button solid small donateButton donateNButton" target="_blank" href="https://act.reprieve.org.uk/page/contribute/egypt-1018?source=eg1018gnpet&amp;default_amt=37">£37
              </a><a class="button outline small donateButton donateNButton" target="_blank" href="https://act.reprieve.org.uk/page/contribute/egypt-1018?source=eg1018gnpet">Other
              </a>
            </div>
            <div class="donate-tab-givemonthly donate-tab-body">
              <p>Giving monthly helps us fund long-term projects and cases.</p>
              <a class="button solid small donateButton donateMButton" target="_blank" href="https://secure.edirectdebit.com/Reprieve/Donate4/?ref=eg1018gmpet&amp;amount=5">£5
              </a><a class="button solid small donateButton donateMButton" target="_blank" href="https://secure.edirectdebit.com/Reprieve/Donate4/?ref=eg1018gmpet&amp;amount=10">£10
              </a><a class="button solid small donateButton donateMButton" target="_blank" href="https://secure.edirectdebit.com/Reprieve/Donate4/?ref=eg1018gmpet&amp;amount=15">£15
              </a><a class="button outline small donateButton donateMButton" target="_blank" href="https://secure.edirectdebit.com/Reprieve/Donate4/?ref=eg1018gmpet">Other
              </a>
            </div>

          </div>
        </div>

        <div class="usdonate" style="display: none;">
          <a href="https://secure.reprieve.org/page/contribute/egypt_donate?default_amt=10" class="solid button small" target="_blank">Donate $10</a>
          <!--
      --><a href="https://secure.reprieve.org/page/contribute/egypt_donate?default_amt=25" class="solid button small" target="_blank">Donate $25</a>
          <!--
      --><a href="https://secure.reprieve.org/page/contribute/egypt_donate?default_amt=50" class="solid button small" target="_blank">Donate $50</a>
          <!--
      --><a href="https://secure.reprieve.org/page/contribute/egypt_donate" class="outline button small" target="_blank">Other amount</a>
        </div>
      </div>
    </div>
  </div>
</div>
<footer id="footer" class="footer">
  <div class="container clearfix">
    <ul class="fnav_sub_primary clearfix">
      <li class="fnav_sub_primary_block first">
        <a href="http://www.reprieve.org.uk" rel="external" class="fnav_sub_element">Reprieve</a>
      </li>
      <li class="fnav_sub_primary_block">
        <a href="http://www.reprieve.org/" rel="external" class="fnav_sub_element">Reprieve US</a>
      </li>
      <li class="fnav_sub_primary_block">
        <a href="http://www.reprieve.org.uk/accessibility/" rel="external" class="fnav_sub_element">Accessibility</a>
      </li>
      <li class="fnav_sub_primary_block">
        <a href="http://www.reprieve.org.uk/privacy/" rel="external" class="fnav_sub_element">Privacy</a>
      </li>
      <li class="fnav_sub_primary_block">
        <a href="https://www.reprieve.org.uk/terms-of-use/" rel="external" class="fnav_sub_element">Terms of use</a>
      </li>
      <li class="fnav_sub_primary_block">
        <a href="https://www.reprieve.org.uk/cookies-policy/" rel="external" class="fnav_sub_element">Cookies</a>
      </li>
      <li class="fnav_sub_primary_block">
        <a href="https://www.reprieve.org.uk/acceptable-use//" rel="external" class="fnav_sub_element">Acceptable Use</a>
      </li>
    </ul>
    <div class="fnav_sub_secondary clearfix">
      <p class="fnav_sub_element">© 2018 Reprieve. Registered charity (No. 1114900).</p>
    </div>
  </div>
</footer>
<div class="mobilemenu-wrapper">
  <div class="mobilemenu-trigger">
    <div class="hamburger is-active" id="hamburger-2">
      <span class="line"></span>
      <span class="line"></span>
      <span class="line"></span>
    </div>
  </div>
  <nav id="mobilemenu">
    <div class="menu">
      <ul id="menu-mobile-menu">
        <li class="menu-item"><a href="https://reprieve.org.uk/">Home</a></li>
        <li class="menu-item"><a href="https://reprieve.org.uk/about/">About</a></li>
        <li class="menu-item"><a href="https://act.reprieve.org.uk/page/s/join">Join us</a></li>
        <li class="menu-item"><a href="https://act.reprieve.org.uk/page/contribute/make-a-donation">Donate now</a></li>
        <li class="menu-item"><a href="https://secure.edirectdebit.com/Reprieve/Donate/">Donate monthly</a></li>
        <li class="menu-item"><a href="https://reprieve.org.uk/contact/">Contact</a></li>
      </ul>
    </div>

  </nav>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
<script type="text/javascript" async src="https://platform.twitter.com/widgets.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.min.js"></script>
<script>
  // Organise
  $("#form-wrap").prependTo("#signup");
  $("#signup .fieldset").appendTo("#form-wrap");
  $("#signup").appendTo("#right");
  $(".optinradio_fieldset").insertBefore("#bsd-field-email_opt_in");

  // Placeholder

  $("span.required").remove();
  $("label").each(function() {
    var label = $(this);
    var placeholder = label.text();
    label.closest(".fieldset").find("input[type=text], input[type=email], textarea").attr("placeholder", placeholder).val("").focus().blur();
  });


  // GDPR

  $(".bsd-contribForm-gdpr-modal-content h3, .bsd-contribForm-gdpr-modal-content p").wrapAll("<div class='col-md-10'>");
  $(".bsd-contribForm-gdpr-modal-content div:nth-of-type(2), .bsd-contribForm-gdpr-modal-content div:nth-of-type(3)").wrap("<div class='col-md-2'>");
  $(".bsd-contribForm-gdpr-modal-content").addClass("container");
  $(".bsd-contribForm-gdpr-modal-content p:nth-of-type(3)").remove();

  // MENU

  $("#hamburger-1").click(function() {
    $("#hamburger-2").toggleClass("is-active");
    $(".mobilemenu-wrapper").toggleClass("menu-active");
  });

  $("#hamburger-2").click(function() {
    $("#hamburger-2").toggleClass("is-active");
    $(".mobilemenu-wrapper").toggleClass("menu-active");
  });

  // Count Signups

  // Petition counter

  jQuery(document).ready(function($) {

    // Set country from parameter

    // Construct URL object using current browser URL
    var url = new URL(document.location);

    // Get query parameters object
    var params = url.searchParams;

    // Get value of country
    var countryurl = params.get("country");

    if (countryurl === null) {
      $("#country").val("GB");
    } else if (countryurl === "US") {
      $("#country").val(countryurl);
      $(".usdonate").show();
      $(".ukdonate").hide();
    } else {
      $("#country").val(countryurl);
    }

    // US Donate

    var optionSelected = $("#country option:selected").val();

    $("#country").on("change", function(e) {
      console.log("CHANGE IS A-COMING!");
      var optionSelected = $("#country option:selected").val();
      if (optionSelected === "US") {
        $(".usdonate").show();
        $(".ukdonate").hide();
      } else {
        $(".usdonate").hide();
        $(".ukdonate").show();
      }
    });

    function count_signups(signup_form_id) {

      // This function formats numbers by adding commas
      function numberFormat(nStr, prefix) {
        var prefix = prefix || '';
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1))
          x1 = x1.replace(rgx, '$1' + ',' + '$2');
        return prefix + x1 + x2;
      }

      function load_counter(data) {
        var cumulativeNum = data * 1;

        console.log(cumulativeNum)

        cumulativeNum += 0; // accounting for offline action

        console.log(cumulativeNum)

        var signups = numberFormat(cumulativeNum);

        var signupsnum = signups.replace(",", "");

        var signupstotal = signupsnum;

        var target = 20000;

        var percentageComplete = (signupstotal / target) * 100;

        $(".totalLevel").css("width", percentageComplete + "%");

        $('.amount').text(signups);

        $('.goal').text("20,000");

        $(".goal-progress").addClass('js-percent');

        var getPercent = percentageComplete;
        var getProgressWrapWidth = $('.js-percent .progress-wrp').width();
        var progressTotal = percentageComplete + "%";
        var animationLength = 2500;

        // on page load, animate percentage bar to data percentage length
        // .stop() used to prevent animation queueing
        $('.js-percent .progress-bar').stop().animate({
          left: progressTotal
        }, animationLength);
        var numTruncated = parseFloat(percentageComplete).toFixed(2);
        $('.js-percent .percentage-number').text(numTruncated + "%");
        $(".goal-progress").removeClass('js-percent');

      }

      bQuery.get("/utils/cons_counter/signup_counter.ajax.php?signup_form_id=159", load_counter);
    }



    count_signups();



  });


  // Expander

  $('#expand').on('click', function(e) {
    $('#expand-box').toggleClass("toggle-expand");
    $('#expand-minus').toggleClass("toggle-expand");
    $('#expand-plus').toggleClass("toggle-collapse");
    e.preventDefault();
  });

  // Donate picker

  $(".donate-tab-gm").click(function() {
    $(".donate-tab-gn").removeClass("picked-tab");
    $(".donate-tab-gm").addClass("picked-tab");
    $(".donate-tab-givenow").removeClass("picked-body");
    $(".donate-tab-givemonthly").addClass("picked-body");
  });
  $(".donate-tab-gn").click(function() {
    $(".donate-tab-gm").removeClass("picked-tab");
    $(".donate-tab-gn").addClass("picked-tab");
    $(".donate-tab-givemonthly").removeClass("picked-body");
    $(".donate-tab-givenow").addClass("picked-body");
  });

  // Optin

  jQuery("#optin_1").change(function() {
    if (jQuery(this).is(":checked")) {
      jQuery('#email_opt_in').prop('checked', true);
      $("#optin_warning").hide();
    }
  });


  jQuery("#optin_0").change(function() {
    if (jQuery(this).is(":checked")) {
      jQuery('#email_opt_in').prop('checked', false);
      $("#optin_warning").show();
    }
  });


  // Data

  var voteName = "Supporter";

  $("#firstname").change(function() {
    voteName = $(this).val();
    $('.first_name').text(voteName)
  });


  $("#signup").submit(function(event) {
    event.preventDefault();
    var $form = $(this),
      url = $form.attr("action");
    var posting = $.post(url, $form.serialize());
    nextSlide('.slide1');
  });



  // SHARING



  jQuery('.twitter_share').click(function(e) {
    var currentUrl = encodeURIComponent("https://act.reprieve.org.uk/page/s/egypt?source=eg1018twp1");
    // <!-- TODO: Insert Tweet text below! -->
    var tweet = encodeURIComponent(
      "Children as young as 16 are facing mass trials in adult courts where death sentences can be handed down. Call on Egypt now to #EndMassInjustice");
    var space = encodeURIComponent(" ");
    window.open("https://twitter.com/intent/tweet?text=" + tweet + space + currentUrl, "_blank", "toolbar=no,scrollbars=no,resizable=yes,width=560,height=560");
    nextSlide('.slide2');
    // initSlider();
  });

  jQuery('.twitter_share').click(function(e) {
    nextSlide('.slide2');
    // initSlider();
  });

  jQuery('#slide2_skip').click(function(e) {
    e.preventDefault();
    nextSlide('.slide2');
    // initSlider();
  });

  var getPathFromUrl = function getPathFromUrl(url) {
    return url.split("?")[0];
  };


  var numberWithCommas = function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  };

  var nextSlide = function nextSlide(el) {
    var marginHeight = jQuery('.top_margin').height();
    var nextSlide = jQuery(el).closest('.slide').next();
    // if (el === '.slide1') {
    //   jQuery('.first_name').html(userInfo.firstname);
    // }
    nextSlide.show();
    jQuery.scrollTo(nextSlide, 1000, {});
  };


  (function(l) {
    'use strict';
    l(['jquery'], function($) {
      var k = $.scrollTo = function(a, b, c) {
        return $(window).scrollTo(a, b, c);
      };
      k.defaults = {
        axis: 'xy',
        duration: 0,
        limit: true
      };

      function isWin(a) {
        return !a.nodeName || $.inArray(a.nodeName.toLowerCase(), ['iframe', '#document', 'html', 'body']) !== -1;
      }
      $.fn.scrollTo = function(f, g, h) {
        if (typeof g === 'object') {
          h = g;
          g = 0;
        }
        if (typeof h === 'function') {
          h = {
            onAfter: h
          };
        }
        if (f === 'max') {
          f = 9e9;
        }
        h = $.extend({}, k.defaults, h);
        g = g || h.duration;
        var j = h.queue && h.axis.length > 1;
        if (j) {
          g /= 2;
        }
        h.offset = both(h.offset);
        h.over = both(h.over);
        return this.each(function() {
          if (f === null) return;
          var d = isWin(this),
            elem = d ? this.contentWindow || window : this,
            $elem = $(elem),
            targ = f,
            attr = {},
            toff;
          switch (typeof targ) {
            case 'number':
            case 'string':
              if (/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)) {
                targ = both(targ);
                break;
              }
              targ = d ? $(targ) : $(targ, elem);
              if (!targ.length) return;
            case 'object':
              if (targ.is || targ.style) {
                toff = (targ = $(targ)).offset();
              }
          }
          var e = $.isFunction(h.offset) && h.offset(elem, targ) || h.offset;
          $.each(h.axis.split(''), function(i, a) {
            var b = a === 'x' ? 'Left' : 'Top',
              pos = b.toLowerCase(),
              key = 'scroll' + b,
              prev = $elem[key](),
              max = k.max(elem, a);
            if (toff) {
              attr[key] = toff[pos] + (d ? 0 : prev - $elem.offset()[pos]);
              if (h.margin) {
                attr[key] -= parseInt(targ.css('margin' + b), 10) || 0;
                attr[key] -= parseInt(targ.css('border' + b + 'Width'), 10) || 0;
              }
              attr[key] += e[pos] || 0;
              if (h.over[pos]) {
                attr[key] += targ[a === 'x' ? 'width' : 'height']() * h.over[pos];
              }
            } else {
              var c = targ[pos];
              attr[key] = c.slice && c.slice(-1) === '%' ? parseFloat(c) / 100 * max : c;
            }
            if (h.limit && /^\d+$/.test(attr[key])) {
              attr[key] = attr[key] <= 0 ? 0 : Math.min(attr[key], max);
            }
            if (!i && h.axis.length > 1) {
              if (prev === attr[key]) {
                attr = {};
              } else if (j) {
                animate(h.onAfterFirst);
                attr = {};
              }
            }
          });
          animate(h.onAfter);

          function animate(a) {
            var b = $.extend({}, h, {
              queue: true,
              duration: g,
              complete: a && function() {
                a.call(elem, targ, h);
              }
            });
            $elem.animate(attr, b);
          }
        });
      };
      k.max = function(a, b) {
        var c = b === 'x' ? 'Width' : 'Height',
          scroll = 'scroll' + c;
        if (!isWin(a)) return a[scroll] - $(a)[c.toLowerCase()]();
        var d = 'client' + c,
          doc = a.ownerDocument || a.document,
          html = doc.documentElement,
          body = doc.body;
        return Math.max(html[scroll], body[scroll]) - Math.min(html[d], body[d]);
      };

      function both(a) {
        return $.isFunction(a) || $.isPlainObject(a) ? a : {
          top: a,
          left: a
        };
      }
      $.Tween.propHooks.scrollLeft = $.Tween.propHooks.scrollTop = {
        get: function get(t) {
          return $(t.elem)[t.prop]();
        },
        set: function set(t) {
          var a = this.get(t);
          if (t.options.interrupt && t._last && t._last !== a) {
            return $(t.elem).stop();
          }
          var b = Math.round(t.now);
          if (a !== b) {
            $(t.elem)[t.prop](b);
            t._last = this.get(t);
          }
        }
      };
      return k;
    });
  })(typeof define === 'function' && define.amd ? define : function(a, b) {
    'use strict';
    if (typeof module !== 'undefined' && module.exports) {
      module.exports = b(require('jquery'));
    } else {
      b(jQuery);
    }
  });

  function submitAndShare() {

    var firstname = $("#firstname").val();

    // <!-- TODO: Insert Facebook Title and Description below -->

    var title = 'Children as young as 16 are facing death sentences in Egypt: Join ' + firstname + ' and sign the petition now!';
    var description = 'Help save at least 10 children facing execution – call on Egypt to close the loophole and #EndMassInjustice';

    shareOverrideOGMeta(window.location.href,
      title,
      description);

    nextSlide('.slide2');


    return false;


  }

  function shareOverrideOGMeta(overrideLink, overrideTitle, overrideDescription) {
    FB.ui({
        method: 'share_open_graph',
        action_type: 'og.shares',
        action_properties: JSON.stringify({
          object: {
            'og:url': overrideLink,
            'og:title': overrideTitle,
            'og:description': overrideDescription,
            // <!-- TODO: Insert Facebook image link below -->
            'og:image': 'https://act.reprieve.org.uk/page/-/EgyptShareCardFinal.png'

          }
        })
      },
      function(response) {
        // Action after response
      });
  }

  function shareOriginal() {
    FB.ui({
        method: 'share',
        href: window.location.href
      },
      function(response) {
        // Action after response
      });

    return false;
  }
</script>
